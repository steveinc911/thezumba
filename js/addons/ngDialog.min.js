/*
 * ngDialog - easy modals and popup windows
 * http://github.com/likeastore/ngDialog
 * (c) 2013-2015 MIT License, https://likeastore.com
 */(function(e,t){typeof module!="undefined"&&module.exports?typeof angular=="undefined"?module.exports=t(require("angular")):module.exports=t(angular):typeof define=="function"&&define.amd?define(["angular"],t):t(e.angular)})(this,function(e){"use strict";var t=e.module("ngDialog",[]),n=e.element,r=e.isDefined,i=(document.body||document.documentElement).style,s=r(i.animation)||r(i.WebkitAnimation)||r(i.MozAnimation)||r(i.MsAnimation)||r(i.OAnimation),o="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",u="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",a="ngdialog-disabled-animation",f={html:!1,body:!1},l={},c=[],h=!1;return t.provider("ngDialog",function(){var t=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(e){f.html=e||!1},this.setForceBodyReload=function(e){f.body=e||!1},this.setDefaults=function(n){e.extend(t,n)};var r=0,i=0,p,d={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(v,m,g,y,b,w,E,S,x,T){var N=[];e.forEach(["html","body"],function(e){N[e]=v.find(e);if(f[e]){var t=C.getRouterLocationEventName();w.$on(t,function(){N[e]=v.find(e)})}});var C={onDocumentKeydown:function(e){e.keyCode===27&&k.close("$escape")},activate:function(e){var t=e.data("$ngDialogOptions");t.trapFocus&&(e.on("keydown",C.onTrapFocusKeydown),N.body.on("keydown",C.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",C.onTrapFocusKeydown),N.body.off("keydown",C.onTrapFocusKeydown)},deactivateAll:function(){e.forEach(function(t){var n=e.element(t);C.deactivate(n)})},setBodyPadding:function(e){var t=parseInt(N.body.css("padding-right")||0,10);N.body.css("padding-right",t+e+"px"),N.body.data("ng-dialog-original-padding",t)},resetBodyPadding:function(){var e=N.body.data("ng-dialog-original-padding");e?N.body.css("padding-right",e+"px"):N.body.css("padding-right","")},performCloseDialog:function(e,t){var n=e.data("$ngDialogOptions"),r=e.attr("id"),u=l[r];if(!u)return;if(typeof S.Hammer!="undefined"){var a=u.hammerTime;a.off("tap",p),a.destroy&&a.destroy(),delete u.hammerTime}else e.unbind("click");i===1&&N.body.unbind("keydown",C.onDocumentKeydown),e.hasClass("ngdialog-closing")||(i-=1);var f=e.data("$ngDialogPreviousFocus");f&&f.focus(),w.$broadcast("ngDialog.closing",e,t),i=i<0?0:i,s&&!n.disableAnimation?(u.$destroy(),e.unbind(o).bind(o,function(){C.closeDialogElement(e,t)}).addClass("ngdialog-closing")):(u.$destroy(),C.closeDialogElement(e,t)),d[r]&&(d[r].resolve({id:r,value:t,$dialog:e,remainingDialogs:i}),delete d[r]),l[r]&&delete l[r],c.splice(c.indexOf(r),1),c.length||(N.body.unbind("keydown",C.onDocumentKeydown),h=!1)},closeDialogElement:function(e,t){e.remove(),i===0&&(N.html.removeClass("ngdialog-open"),N.body.removeClass("ngdialog-open"),C.resetBodyPadding()),w.$broadcast("ngDialog.closed",e,t)},closeDialog:function(t,n){var r=t.data("$ngDialogPreCloseCallback");if(r&&e.isFunction(r)){var i=r.call(t,n);e.isObject(i)?i.closePromise?i.closePromise.then(function(){C.performCloseDialog(t,n)}):i.then(function(){C.performCloseDialog(t,n)},function(){return}):i!==!1&&C.performCloseDialog(t,n)}else C.performCloseDialog(t,n)},onTrapFocusKeydown:function(t){var n=e.element(t.currentTarget),r;if(n.hasClass("ngdialog"))r=n;else{r=C.getActiveDialog();if(r===null)return}var i=t.keyCode===9,s=t.shiftKey===!0;i&&C.handleTab(r,t,s)},handleTab:function(e,t,n){var r=C.getFocusableElements(e);if(r.length===0){document.activeElement&&document.activeElement.blur();return}var i=document.activeElement,s=Array.prototype.indexOf.call(r,i),o=s===-1,u=s===0,a=s===r.length-1,f=!1;if(n){if(o||u)r[r.length-1].focus(),f=!0}else if(o||a)r[0].focus(),f=!0;f&&(t.preventDefault(),t.stopPropagation())},autoFocus:function(e){var t=e[0],r=t.querySelector("*[autofocus]");if(r!==null){r.focus();if(document.activeElement===r)return}var i=C.getFocusableElements(e);if(i.length>0){i[0].focus();return}var s=C.filterVisibleElements(t.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(s.length>0){var o=s[0];n(o).attr("tabindex","-1").css("outline","0"),o.focus()}},getFocusableElements:function(e){var t=e[0],n=t.querySelectorAll(u),r=C.filterTabbableElements(n);return C.filterVisibleElements(r)},filterTabbableElements:function(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];n(i).attr("tabindex")!=="-1"&&t.push(i)}return t},filterVisibleElements:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];(r.offsetWidth>0||r.offsetHeight>0)&&t.push(r)}return t},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return e.length===0?null:n(e[e.length-1])},applyAriaAttributes:function(e,t){if(t.ariaAuto){if(!t.ariaRole){var n=C.getFocusableElements(e).length>0?"dialog":"alertdialog";t.ariaRole=n}t.ariaLabelledBySelector||(t.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),t.ariaDescribedBySelector||(t.ariaDescribedBySelector="article,section,p")}t.ariaRole&&e.attr("role",t.ariaRole),C.applyAriaAttribute(e,"aria-labelledby",t.ariaLabelledById,t.ariaLabelledBySelector),C.applyAriaAttribute(e,"aria-describedby",t.ariaDescribedById,t.ariaDescribedBySelector)},applyAriaAttribute:function(e,t,r,i){r&&e.attr(t,r);if(i){var s=e.attr("id"),o=e[0].querySelector(i);if(!o)return;var u=s+"-"+t;return n(o).attr("id",u),e.attr(t,u),u}},detectUIRouter:function(){try{return e.module("ui.router"),!0}catch(t){return!1}},getRouterLocationEventName:function(){return C.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},k={open:function(s){function _(e,t){return w.$broadcast("ngDialog.templateLoading",e),b.get(e,t||{}).then(function(t){return w.$broadcast("ngDialog.templateLoaded",e),t.data||""})}function D(t){return t?e.isString(t)&&o.plain?t:typeof o.cache=="boolean"&&!o.cache?_(t,{cache:!1}):_(t,{cache:m}):"Empty template"}var o=e.copy(t),u=++r,f="ngdialog"+u;c.push(f),s=s||{},e.extend(o,s);var v;d[f]=v=y.defer();var L;l[f]=L=e.isObject(o.scope)?o.scope.$new():w.$new();var A,O,M=e.extend({},o.resolve);return e.forEach(M,function(t,n){M[n]=e.isString(t)?T.get(t):T.invoke(t,null,null,n)}),y.all({template:D(o.template||o.templateUrl),locals:y.all(M)}).then(function(t){var r=t.template,s=t.locals;o.showClose&&(r+='<div class="ngdialog-close"></div>'),A=n('<div id="ngdialog'+u+'" class="ngdialog"></div>'),A.html(o.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+r+"</div>":'<div class="ngdialog-content" role="document">'+r+"</div>"),A.data("$ngDialogOptions",o),L.ngDialogId=f;if(o.data&&e.isString(o.data)){var l=o.data.replace(/^\s*/,"")[0];L.ngDialogData=l==="{"||l==="["?e.fromJson(o.data):o.data,L.ngDialogData.ngDialogId=f}else o.data&&e.isObject(o.data)&&(L.ngDialogData=o.data,L.ngDialogData.ngDialogId=f);if(o.controller&&(e.isString(o.controller)||e.isArray(o.controller)||e.isFunction(o.controller))){var c;o.controllerAs&&e.isString(o.controllerAs)&&(c=o.controllerAs);var d=x(o.controller,e.extend(s,{$scope:L,$element:A}),null,c);A.data("$ngDialogControllerController",d)}o.className&&A.addClass(o.className),o.disableAnimation&&A.addClass(a),o.appendTo&&e.isString(o.appendTo)?O=e.element(document.querySelector(o.appendTo)):O=N.body,C.applyAriaAttributes(A,o);if(o.preCloseCallback){var v;e.isFunction(o.preCloseCallback)?v=o.preCloseCallback:e.isString(o.preCloseCallback)&&L&&(e.isFunction(L[o.preCloseCallback])?v=L[o.preCloseCallback]:L.$parent&&e.isFunction(L.$parent[o.preCloseCallback])?v=L.$parent[o.preCloseCallback]:w&&e.isFunction(w[o.preCloseCallback])&&(v=w[o.preCloseCallback])),v&&A.data("$ngDialogPreCloseCallback",v)}L.closeThisDialog=function(e){C.closeDialog(A,e)},E(function(){var e=document.querySelectorAll(".ngdialog");C.deactivateAll(e),g(A)(L);var t=S.innerWidth-N.body.prop("clientWidth");N.html.addClass("ngdialog-open"),N.body.addClass("ngdialog-open");var n=t-(S.innerWidth-N.body.prop("clientWidth"));n>0&&C.setBodyPadding(n),O.append(A),C.activate(A),o.trapFocus&&C.autoFocus(A),o.name?w.$broadcast("ngDialog.opened",{dialog:A,name:o.name}):w.$broadcast("ngDialog.opened",A)}),h||(N.body.bind("keydown",C.onDocumentKeydown),h=!0);if(o.closeByNavigation){var m=C.getRouterLocationEventName();w.$on(m,function(){C.closeDialog(A)})}o.preserveFocus&&A.data("$ngDialogPreviousFocus",document.activeElement),p=function(e){var t=o.closeByDocument?n(e.target).hasClass("ngdialog-overlay"):!1,r=n(e.target).hasClass("ngdialog-close");(t||r)&&k.close(A.attr("id"),r?"$closeButton":"$document")};if(typeof S.Hammer!="undefined"){var y=L.hammerTime=S.Hammer(A[0]);y.on("tap",p)}else A.bind("click",p);return i+=1,k}),{id:f,closePromise:v.promise,close:function(e){C.closeDialog(A,e)}}},openConfirm:function(t){var r=y.defer(),i={closeByEscape:!1,closeByDocument:!1};e.extend(i,t),i.scope=e.isObject(i.scope)?i.scope.$new():w.$new(),i.scope.confirm=function(e){r.resolve(e);var t=n(document.getElementById(s.id));C.performCloseDialog(t,e)};var s=k.open(i);return s.closePromise.then(function(e){return e?r.reject(e.value):r.reject()}),r.promise},isOpen:function(e){var t=n(document.getElementById(e));return t.length>0},close:function(e,t){var r=n(document.getElementById(e));if(r.length)C.closeDialog(r,t);else if(e==="$escape"){var i=c[c.length-1];r=n(document.getElementById(i)),r.data("$ngDialogOptions").closeByEscape&&C.closeDialog(r,t)}else k.closeAll(t);return k},closeAll:function(e){var t=document.querySelectorAll(".ngdialog");for(var r=t.length-1;r>=0;r--){var i=t[r];C.closeDialog(n(i),e)}},getOpenDialogs:function(){return c},getDefaults:function(){return t}};return k}]}),t.directive("ngDialog",["ngDialog",function(t){return{restrict:"A",scope:{ngDialogScope:"="},link:function(n,r,i){r.on("click",function(r){r.preventDefault();var s=e.isDefined(n.ngDialogScope)?n.ngDialogScope:"noScope";e.isDefined(i.ngDialogClosePrevious)&&t.close(i.ngDialogClosePrevious);var o=t.getDefaults();t.open({template:i.ngDialog,className:i.ngDialogClass||o.className,controller:i.ngDialogController,controllerAs:i.ngDialogControllerAs,bindToController:i.ngDialogBindToController,scope:s,data:i.ngDialogData,showClose:i.ngDialogShowClose==="false"?!1:i.ngDialogShowClose==="true"?!0:o.showClose,closeByDocument:i.ngDialogCloseByDocument==="false"?!1:i.ngDialogCloseByDocument==="true"?!0:o.closeByDocument,closeByEscape:i.ngDialogCloseByEscape==="false"?!1:i.ngDialogCloseByEscape==="true"?!0:o.closeByEscape,overlay:i.ngDialogOverlay==="false"?!1:i.ngDialogOverlay==="true"?!0:o.overlay,preCloseCallback:i.ngDialogPreCloseCallback||o.preCloseCallback})})}}}]),t});